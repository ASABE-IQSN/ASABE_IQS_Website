{% extends "layout.html" %}

{% block title %}{{ event.event_name }} – Event Overview{% endblock %}

{% block extra_styles %}
  .hero {
    margin-bottom: 1.5rem;
    padding: 1rem 1.25rem;
    border-radius: 0.9rem;
    background: #0f172a;
    border: 1px solid #1f2937;
  }

  .hero h1 {
    margin: 0 0 0.4rem;
    font-size: 1.6rem;
  }

  .hero-meta {
    font-size: 0.9rem;
    color: #9ca3af;
  }

  h2 {
    margin-top: 1.5rem;
    margin-bottom: 0.5rem;
    font-size: 1.2rem;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    background: #020617;
    border-radius: 0.75rem;
    overflow: hidden;
    margin-bottom: 1.5rem;
  }

  th, td {
    padding: 0.55rem 0.75rem;
    border-bottom: 1px solid #1f2937;
    font-size: 0.9rem;
    text-align: left;
  }

  th {
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    color: #9ca3af;
    background: #030712;
  }

  tr:last-child td {
    border-bottom: none;
  }

  tbody tr:nth-child(even) {
    background: #020617;
  }

  .empty {
    font-size: 0.9rem;
    color: #9ca3af;
    margin-bottom: 1rem;
  }

  .hook-section {
    margin-bottom: 1.5rem;
    padding: 1rem 1.25rem;
    border-radius: 0.9rem;
    background: #0b1120;
    border: 1px solid #1f2937;
  }

  .hook-header {
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    gap: 1rem;
    margin-bottom: 0.75rem;
  }

  .hook-header h3 {
    margin: 0;
    font-size: 1.05rem;
  }

  .hook-winner {
    font-size: 0.85rem;
    color: #9ca3af;
    text-align: right;
  }

  .hook-winner span {
    font-weight: 600;
    color: #e5e7eb;
  }
{% endblock %}

{% block content %}
  <!-- Event hero -->
  <section class="hero">
    <h1>{{ event.event_name }}</h1>
    <div class="hero-meta">
      {% if event.event_datetime %}
        <div>
          Date &amp; time:
          {{ event.event_datetime.strftime("%B %d, %Y %I:%M %p") }}
        </div>
      {% endif %}
      <div>
        Total teams in this event: <strong>{{ event.event_teams|length }}</strong>
      </div>
      <div>
        Total hooks: <strong>{{ event.hooks|length }}</strong>
      </div>
    </div>
  </section>

  <!-- Rankings -->
  <section>
    <h2>Rankings</h2>
    {% if event.event_teams %}
      <table>
        <thead>
          <tr>
            <th>Rank</th>
            <th>Team</th>
            <th>Team #</th>
            <th>Total Score</th>
          </tr>
        </thead>
        <tbody>
          {% for et in event.event_teams %}
            <tr>
              <td>{{ loop.index }}</td>
              <td>
                <a href="{{ url_for('team_event_detail', event_id=event.event_id, team_id=et.team_id) }}">
                  {{ et.team.team_name }}
                </a>
              </td>
              <td>{{ et.team.team_number }}</td>
              <td>{{ et.total_score if et.total_score is not none else 'N/A' }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p class="empty">No rankings available for this event yet.</p>
    {% endif %}
  </section>

  <!-- Hook results -->
  <section>
    <h2>Hook results</h2>

    {% if event.hooks %}
      {% for hook in event.hooks %}
        <div class="hook-section">
          <div class="hook-header">
            <h3>{{ hook.hook_name or ("Hook " ~ hook.hook_id) }}</h3>

            <div class="hook-winner">
              {% if hook.pulls %}
                {# pulls ordered by final_distance desc in relationship #}
                {% set best = hook.pulls[0] %}
                Best pull:
                <span>{{ best.team.team_name }}</span>
                – {{ best.final_distance if best.final_distance is not none else 'N/A' }}
              {% else %}
                No pulls yet.
              {% endif %}
            </div>
          </div>

          {% if hook.pulls %}
            <table>
              <thead>
                <tr>
                  <th>Team</th>
                  <th>Team #</th>
                  <th>Final Distance</th>
                  <th>Details</th>
                </tr>
              </thead>
              <tbody>
                {% for pull in hook.pulls %}
                  <tr>
                    <td>{{ pull.team.team_name }}</td>
                    <td>{{ pull.team.team_number }}</td>
                    <td>{{ pull.final_distance or 'N/A' }}</td>
                    <td>
                      <a href="{{ url_for('pull_detail', pull_id=pull.pull_id) }}">
                        View pull
                      </a>
                    </td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          {% else %}
            <p class="empty">No pulls for this hook yet.</p>
          {% endif %}
        </div>
      {% endfor %}
    {% else %}
      <p class="empty">No hooks defined for this event.</p>
    {% endif %}
  </section>
{% endblock %}
