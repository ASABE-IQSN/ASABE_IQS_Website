{% extends "layout.html" %}

{% block title %}Events – International Quarter Scale{% endblock %}

{% block extra_styles %}
  .event-card {
    background: #0f172a;
    border-radius: 0.9rem;
    border: 1px solid #1f2937;
    padding: 1.25rem 1.5rem;
    margin-bottom: 1.5rem;
  }

  .event-card h2 {
    margin: 0 0 0.25rem;
    font-size: 1.35rem;
  }

  .event-meta {
    color: #9ca3af;
    font-size: 0.85rem;
    margin-bottom: 0.75rem;
  }

  h1 {
    margin-bottom: 1.5rem;
    font-size: 1.8rem;
  }

  h3 {
    margin-top: 0.8rem;
    margin-bottom: 0.4rem;
    font-size: 1.0rem;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    background: #1b152d;
    border-radius: 0.75rem;
    overflow: hidden;
  }

  th, td {
    padding: 0.55rem 0.75rem;
    border-bottom: 1px solid #1f2937;
    font-size: 0.9rem;
    text-align: left;
  }

  th {
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    color: #9ca3af;
    background: #030712;
  }

  tr:last-child td {
    border-bottom: none;
  }

  tbody tr:nth-child(even) {
    background: #1b152d;
  }

  .class-tables {
    display: flex;
    gap: 1rem;
    margin-top: 0.75rem;
    flex-wrap: wrap;
  }

  .class-table {
    flex: 1 1 0;
    min-width: 0;
  }
{% endblock %}

{% block content %}
  <h1>Events</h1>

  {% for event in events %}
    <section class="event-card">
      <h2>
        <a href="{{ url_for('event_detail', event_id=event.event_id) }}">
          {{ event.event_name }}
        </a>
      </h2>

      {% if event.event_datetime %}
        <div class="event-meta">
          {{ event.event_datetime.strftime("%B %Y") }}
        </div>
      {% endif %}

      {% if event.event_teams %}
        {% if top_classes %}
          <div class="class-tables">
            {% for tc in top_classes %}
              {% set class_entries = event.event_teams
                    | selectattr('team.team_class_id', 'equalto', tc.team_class_id)
                    | list %}
              {% if class_entries %}
                <div class="class-table">
                  <h3>{{ tc.name }} – Top 3</h3>
                  <table>
                    <thead>
                      <tr>
                        <th>Team</th>
                        <th>Team #</th>
                        <th>Total Score</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for et in class_entries[:3] %}
                        <tr>
                          <td>
                            <a href="{{ url_for('team_event_detail', event_id=event.event_id, team_id=et.team_id) }}">
                              {{ et.team.team_name }}
                            </a>
                          </td>
                          <td>{{ et.team.team_number }}</td>
                          <td>{{ et.total_score or 'N/A' }}</td>
                        </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </div>
              {% endif %}
            {% endfor %}
          </div>
        {% else %}
          <p class="empty">No team classes defined yet.</p>
        {% endif %}
      {% else %}
        <p class="empty">No teams for this event yet.</p>
      {% endif %}
    </section>
  {% endfor %}
{% endblock %}
