{% extends "base.html" %}
{% load static %}
{% block title %}Live Durability â€“ {{ event.event_name|default:"IQS Live" }}{% endblock %}

{% block extra_head %}
  <link rel="stylesheet" href="{% static 'live/css/live_durability.css' %}?1">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
{% endblock %}

{% block content %}

<script>
  window.IQS = {
    apiUrl: "{{ api_url }}",
  };
</script>

<script defer src="{% static 'live/js/live_durability.js' %}"></script>

<div class="live-page">
  <header>
    <h1>Live Durability</h1>
  </header>

  <section class="panel panel-video">
    <div class="panel-head">
      <h2 class="panel-title">Live Stream</h2>
      <div class="chip chip-live">STREAM</div>
    </div>

    <div class="video-wrap">
      <iframe
        src="https://www.youtube.com/embed/X6kVYh22shk?autoplay=1&mute=1&rel=0&modestbranding=1"
        title="Live Durability Stream"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
        referrerpolicy="strict-origin-when-cross-origin"
        allowfullscreen>
      </iframe>
    </div>
  </section>

  <div class="grid">
    <!-- Left column: Chart -->
    <div class="panel">
      <div class="panel-head">
        <div>
          <h2 class="panel-title">Live Telemetry</h2>
          <div class="panel-subtitle">Speed, Pressure, Power over Time</div>
        </div>
      </div>
      <div class="panel-chart">
        <canvas id="liveChart"></canvas>
      </div>
    </div>

    <!-- Right column: Current Run Info -->
    <div class="panel panel-current">
      <div class="panel-head">
        <h2 class="panel-title">Current Run</h2>
        <div class="chip chip-live" id="sseStatus">LIVE</div>
      </div>

      <div class="current-grid">
        <!-- left side: metadata -->
        <div class="current-meta">
          <div>
            <span class="k">Team</span>
            <strong><span data-field="team_name">Waiting...</span></strong>
            <span class="muted">#<span data-field="team_number">-</span></span>
          </div>
          <div>
            <span class="k">Tractor</span>
            <strong><span data-field="tractor_name">None</span></strong>
          </div>
          <div>
            <span class="k">Event</span>
            <strong><span data-field="event">-</span></strong>
          </div>
          <div>
            <span class="k">Status</span>
            <strong><span data-field="status">Waiting</span></strong>
          </div>
        </div>

        <!-- right side: live stats -->
        <div class="current-live">
          <div class="live-stat">
            <div class="live-label">Current Lap</div>
            <div class="live-value"><span data-field="current_lap">0</span></div>
          </div>

          <div class="live-stat">
            <div class="live-label">Total Laps</div>
            <div class="live-value"><span data-field="total_laps">0</span></div>
          </div>

          <div class="live-stat">
            <div class="live-label">Elapsed Time</div>
            <div class="live-value"><span data-field="elapsed_time">0</span> <span class="live-unit">s</span></div>
          </div>

          <div class="live-stat">
            <div class="live-label">Speed</div>
            <div class="live-value"><span data-field="speed">0</span> <span class="live-unit">mph</span></div>
          </div>

          <div class="live-stat">
            <div class="live-label">Pressure</div>
            <div class="live-value"><span data-field="pressure">0</span> <span class="live-unit">psi</span></div>
          </div>

          <div class="live-stat">
            <div class="live-label">Power</div>
            <div class="live-value"><span data-field="power">0</span> <span class="live-unit">hp</span></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Up Next Panel -->
  <div class="panel panel-up-next">
    <div class="panel-head">
      <div>
        <h2 class="panel-title">Up Next</h2>
        <div class="panel-subtitle">Next 5 teams to run</div>
      </div>
      <div class="chip" id="upNextCount">0</div>
    </div>

    <div id="upNextList" class="up-next-list">
      <div class="empty" id="upNextEmpty">No teams queued.</div>
    </div>
  </div>

</div>

{% endblock %}
