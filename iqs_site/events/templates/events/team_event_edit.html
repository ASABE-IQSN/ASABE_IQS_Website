{% extends "base.html" %}

{% block title %}Edit – {{ team.team_name }} – {{ event.event_name }}{% endblock %}

{% block content %}
  <div class="breadcrumbs" style="font-size:0.8rem; color:#9ca3af; margin-bottom:0.75rem;">
    <a href="{% url 'events:event_list' %}" style="color:#9ca3af;">Events</a>
    <span>›</span>
    <a href="{% url 'events:event_detail' event.event_id %}" style="color:#9ca3af;">{{ event.event_name }}</a>
    <span>›</span>
    <a href="{% url 'events:team_event_detail' event.event_id team.team_id %}" style="color:#9ca3af;">{{ team.team_name }}</a>
    <span>›</span>
    <span>Edit</span>
  </div>

  <section class="card" style="max-width: 900px;">
    <h2 style="margin-top:0;">Edit {{ team.team_name }} – {{ event.event_name }}</h2>

    {% if messages %}
      {% for message in messages %}
        <div style="padding:0.5rem 0.75rem; margin-bottom:0.75rem; border-radius:0.5rem; font-size:0.85rem;
          {% if message.tags == 'success' %}background:#052e16; border:1px solid #166534; color:#bbf7d0;
          {% elif message.tags == 'error' %}background:#450a0a; border:1px solid #991b1b; color:#fecaca;
          {% else %}background:#0b1120; border:1px solid #1f2937; color:#9ca3af;{% endif %}">
          {{ message }}
        </div>
      {% endfor %}
    {% endif %}

    <form method="post" enctype="multipart/form-data">
      {% csrf_token %}

      <div style="display:grid; gap:0.9rem;">

        <!-- Report Upload Section -->
        <div>
          <label><strong>Upload Report (PDF)</strong></label><br>
          <input type="file" name="report" accept=".pdf"
                 style="padding: 0.4rem; border: 1px solid #1f2937; border-radius: 0.5rem; background: #020617; color: #F3F6E7; font-size: 0.9rem; width: 100%; margin-bottom: 0.5rem;">
          <div style="font-size:0.8rem; color:#9ca3af; margin-top: 0.3rem;">
            Upload a team report for this event. Supported format: PDF.
          </div>
        </div>

        <!-- Existing Reports -->
        {% if existing_reports %}
          <div style="margin-top: 0.5rem;">
            <label><strong>Current Reports</strong></label>
            <div style="font-size:0.8rem; color:#9ca3af; margin-bottom: 0.5rem;">
              Reports already uploaded for this event.
            </div>
            <div style="display: grid; gap: 0.5rem;">
              {% for report in existing_reports %}
                <div style="padding: 0.5rem 0.75rem; background: #020617; border: 1px solid #1f2937; border-radius: 0.5rem; font-size: 0.85rem; color: #9ca3af; display: flex; align-items: center; gap: 0.5rem;">
                  <span style="color: #F3F6E7;">{{ report.report_link }}</span>
                  <a href="{% url 'events:report' report.report_id %}" target="_blank"
                     style="color: #60a5fa; font-size: 0.8rem; margin-left: auto;">View</a>
                </div>
              {% endfor %}
            </div>
          </div>
        {% endif %}

        <hr style="border:0; border-top:1px solid #1f2937; margin:0.25rem 0;">

        <!-- Photo Upload Section -->
        <div>
          <label><strong>Upload Photo</strong></label><br>
          <input type="file" name="photo" accept="image/*"
                 style="padding: 0.4rem; border: 1px solid #1f2937; border-radius: 0.5rem; background: #020617; color: #F3F6E7; font-size: 0.9rem; width: 100%; margin-bottom: 0.5rem;">
          <div style="font-size:0.8rem; color:#9ca3af; margin-top: 0.3rem;">
            Upload a team photo from this event. Supported formats: PNG, JPG, JPEG, GIF, WebP.
          </div>
        </div>

        <!-- Existing Photos with Caption Editing -->
        {% if existing_photos %}
          <div style="margin-top: 0.5rem;">
            <label><strong>Edit Photo Captions</strong></label>
            <div style="font-size:0.8rem; color:#9ca3af; margin-bottom: 0.5rem;">
              Update captions for existing photos.
            </div>

            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 1rem; margin-top: 0.5rem;">
              {% for photo in existing_photos %}
                <div style="border: 2px solid #1f2937; border-radius: 0.5rem; padding: 0.5rem; background: #020617;">
                  <img src="/media/{{ photo.photo_path }}" alt="{{ photo.caption|default:'Event photo' }}"
                       style="width: 100%; height: 120px; object-fit: cover; border-radius: 0.25rem; display: block;">
                  <input type="text" name="caption_{{ photo.event_team_photo_id }}"
                         value="{{ photo.caption|default:'' }}" maxlength="255" placeholder="Add caption..."
                         style="width: 100%; margin-top: 0.5rem; padding: 0.35rem 0.5rem; border: 1px solid #1f2937; border-radius: 0.25rem; background: #0b1120; color: #F3F6E7; font-size: 0.75rem;">
                </div>
              {% endfor %}
            </div>
          </div>
        {% endif %}

        <hr style="border:0; border-top:1px solid #1f2937; margin:0.25rem 0;">

      </div>

      <div style="margin-top: 1rem; display:flex; gap:0.5rem;">
        <button type="submit"
                style="padding:0.45rem 1rem; border-radius:999px; border:1px solid #1f2937; background:#22c55e; color:#020617; cursor:pointer;">
          Save
        </button>

        <a href="{% url 'events:team_event_detail' event.event_id team.team_id %}"
           style="padding:0.45rem 1rem; border-radius:999px; border:1px solid #1f2937; background:#111827; color:#F3F6E7; text-decoration:none;">
          Cancel
        </a>
      </div>
    </form>
  </section>
{% endblock %}
